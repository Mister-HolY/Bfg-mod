from aiogram import Dispatcher, types
from assets.antispam import antispam
from commands.db import conn as conngdb, cursor as cursorgdb

@antispam
async def get_user_id(message: types.Message):
    if not message.reply_to_message:
        await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –µ–≥–æ ID.")
        return

    target_user_id = message.reply_to_message.from_user.id
    result = cursorgdb.execute('SELECT game_id FROM users WHERE user_id = ?', (target_user_id,)).fetchone()
    
    if result:
        game_id = result[0]
        await message.answer(f"ü™™ ID Telegram –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - {target_user_id}\nüÜî ID —á–µ–ª–æ–≤–µ–∫–∞ –≤ –±–æ—Ç–µ - {game_id}")
    else:
        await message.answer(f"ü™™ ID Telegram –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - {target_user_id}\n‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞.")

def register_handlers(dp: Dispatcher):
    dp.register_message_handler(get_user_id, commands=['—É–∑–Ω–∞—Ç—å_–∏–¥'])

MODULE_DESCRIPTION = {
    'name': 'ü™™ –£–∑–Ω–∞—Ç—å ID',
    'description': '–ú–æ–¥—É–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∑–Ω–∞—Ç—å Telegram ID –∏ ID –≤ –±–æ—Ç–µ –ø–æ –∫–æ–º–∞–Ω–¥–µ /—É–∑–Ω–∞—Ç—å_–∏–¥ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.'
}
